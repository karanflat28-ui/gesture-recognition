<!DOCTYPE html>
<html>
<head>
<title>Nebula V Sign</title>

<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<style>
body { margin:0; background:black; overflow:hidden; }
#info {
  position:absolute;
  top:20px;
  width:100%;
  text-align:center;
  color:#00ffff;
  font-size:28px;
  font-family:Arial;
}
video {
  position:absolute;
  bottom:10px;
  left:10px;
  width:150px;
  transform:scaleX(-1);
  opacity:0.4;
  border:1px solid #00ffff;
}
</style>
</head>

<body>

<div id="info">Show V Sign ✌</div>
<video id="webcam" autoplay playsinline></video>

<script>

// ====================
// THREE.JS SETUP
// ====================

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(
  75, window.innerWidth/window.innerHeight, 0.1, 1000
);
camera.position.z = 40;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const starCount = 4000;
const geometry = new THREE.BufferGeometry();
const positions = new Float32Array(starCount*3);
const targets = new Float32Array(starCount*3);

for(let i=0;i<starCount*3;i++){
  positions[i]=(Math.random()-0.5)*80;
  targets[i]=positions[i];
}

geometry.setAttribute(
  "position",
  new THREE.BufferAttribute(positions,3)
);

const stars = new THREE.Points(
  geometry,
  new THREE.PointsMaterial({color:0x00ffff,size:0.25})
);

scene.add(stars);


// ====================
// TEXT SHAPE
// ====================

function createTextPoints(){

  const canvas=document.createElement("canvas");
  canvas.width=600;
  canvas.height=200;
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="black";
  ctx.fillRect(0,0,600,200);

  ctx.fillStyle="white";
  ctx.font="bold 80px Arial";
  ctx.textAlign="center";
  ctx.fillText("HAVE A GREAT DAY",300,120);

  const data=ctx.getImageData(0,0,600,200).data;
  const points=[];

  for(let y=0;y<200;y+=2){
    for(let x=0;x<600;x+=2){
      if(data[(y*600+x)*4]>150){
        points.push({
          x:(x-300)*0.07,
          y:(100-y)*0.07
        });
      }
    }
  }

  return points;
}

const textPoints=createTextPoints();


// ====================
// CLOUD MODE
// ====================

function cloud(){
  for(let i=0;i<starCount;i++){
    const angle=i*0.2+Date.now()*0.001;
    targets[i*3]=Math.cos(angle)*15;
    targets[i*3+1]=Math.sin(angle)*15;
    targets[i*3+2]=Math.sin(i)*5;
  }
}


// ====================
// TEXT MODE
// ====================

function formText(){
  for(let i=0;i<starCount;i++){
    const index=Math.floor(i/starCount*textPoints.length);
    const p=textPoints[index];
    targets[i*3]=p.x*2;
    targets[i*3+1]=p.y*2;
    targets[i*3+2]=0;
  }
}


// ====================
// ANIMATION LOOP
// ====================

function animate(){
  requestAnimationFrame(animate);

  const pos=geometry.attributes.position.array;

  for(let i=0;i<starCount*3;i++){
    pos[i]+=(targets[i]-pos[i])*0.08;
  }

  geometry.attributes.position.needsUpdate=true;
  stars.rotation.y+=0.001;

  renderer.render(scene,camera);
}

animate();
cloud();


// ====================
// MEDIAPIPE HANDS
// ====================

const video=document.getElementById("webcam");
const info=document.getElementById("info");

const hands=new Hands({
  locateFile:(file)=>
  `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands:1,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
});

hands.onResults(results=>{

  if(results.multiHandLandmarks &&
     results.multiHandLandmarks.length>0){

    const lm=results.multiHandLandmarks[0];

    const isV=
      lm[8].y < lm[6].y &&      // index up
      lm[12].y < lm[10].y &&    // middle up
      lm[16].y > lm[14].y &&    // ring down
      lm[20].y > lm[18].y;      // pinky down

    if(isV){
      info.innerText="HAVE A GREAT DAY";
      formText();
    }else{
      info.innerText="Show V Sign ✌";
      cloud();
    }

  }else{
    info.innerText="Searching for hand...";
    cloud();
  }
});


// ====================
// CAMERA START
// ====================

const cameraFeed=new Camera(video,{
  onFrame: async ()=>{
    await hands.send({image:video});
  },
  width:640,
  height:480
});

cameraFeed.start();


// ====================
// RESIZE
// ====================

window.addEventListener("resize",()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>