<!DOCTYPE html>
<html>
<head>
    <title>Nebula: Perfect Text V-Sign</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js"></script>

    <style>
        body {
            margin: 0;
            background: #000;
            overflow: hidden;
            color: white;
            font-family: 'Orbitron', sans-serif;
        }

        #start-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            z-index: 10;
            cursor: pointer;
            background: #00ffff;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
        }

        #info {
            position: absolute;
            width: 100%;
            text-align: center;
            top: 20px;
            font-size: 28px;
            color: #00ffff;
            text-shadow: 0 0 20px #00ffff;
            letter-spacing: 2px;
        }

        video {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 160px;
            transform: scaleX(-1);
            border: 1px solid #00ffff;
            opacity: 0.4;
        }
    </style>
</head>

<body>

<button id="start-btn">ENGAGE NEBULA</button>
<div id="info">SYSTEM OFFLINE</div>
<video id="webcam" autoplay playsinline></video>

<script>
const video = document.getElementById('webcam');
const info = document.getElementById('info');


// ============================
// 1️⃣ TEXT BLUEPRINT (HIGH RES)
// ============================

const textCanvas = document.createElement('canvas');
const tCtx = textCanvas.getContext('2d');

textCanvas.width = 800;
textCanvas.height = 200;

function getTextPoints() {

    tCtx.fillStyle = 'black';
    tCtx.fillRect(0, 0, 800, 200);

    tCtx.fillStyle = 'white';
    tCtx.font = 'bold 90px Arial';
    tCtx.textAlign = 'center';
    tCtx.fillText("HAVE A GREAT DAY", 400, 120);

    const points = [];
    const imageData = tCtx.getImageData(0, 0, 800, 200).data;

    for (let y = 0; y < 200; y += 1) {
        for (let x = 0; x < 800; x += 1) {
            if (imageData[(y * 800 + x) * 4] > 150) {
                points.push({
                    x: (x - 400) * 0.05,
                    y: (100 - y) * 0.05
                });
            }
        }
    }

    return points;
}

const textPoints = getTextPoints();


// ============================
// 2️⃣ THREE.JS SCENE
// ============================

const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
);

camera.position.z = 40;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);


// ============================
// 3️⃣ PARTICLES
// ============================

const starCount = 5000;

const geometry = new THREE.BufferGeometry();
const positions = new Float32Array(starCount * 3);
const targets = new Float32Array(starCount * 3);

for (let i = 0; i < starCount * 3; i++) {
    positions[i] = (Math.random() - 0.5) * 80;
    targets[i] = positions[i];
}

geometry.setAttribute(
    'position',
    new THREE.BufferAttribute(positions, 3)
);

const material = new THREE.PointsMaterial({
    color: 0x00ffff,
    size: 0.25
});

const stars = new THREE.Points(geometry, material);
scene.add(stars);


// ============================
// 4️⃣ CLOUD RESET FUNCTION
// ============================

function resetToCloud() {

    for (let i = 0; i < starCount; i++) {

        const angle = i * 0.15 + Date.now() * 0.001;

        targets[i * 3]     = Math.cos(angle) * 15;
        targets[i * 3 + 1] = Math.sin(angle) * 15;
        targets[i * 3 + 2] = Math.sin(i) * 5;
    }
}


// ============================
// 5️⃣ HAND TRACKING
// ============================

const hands = new Hands({
    locateFile: (file) =>
        `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`
});

hands.setOptions({
    maxNumHands: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.6
});

hands.onResults((results) => {

    if (results.multiHandLandmarks &&
        results.multiHandLandmarks.length > 0) {

        const lm = results.multiHandLandmarks[0];

        const isV =
            lm[8].y < lm[6].y &&      // index up
            lm[12].y < lm[10].y &&    // middle up
            lm[16].y > lm[14].y &&    // ring down
            lm[20].y > lm[18].y;      // pinky down

        if (isV) {

            info.innerText = "HAVE A GREAT DAY";

            for (let i = 0; i < starCount; i++) {

                const index =
                    Math.floor(i / starCount * textPoints.length);

                const pt = textPoints[index];

                targets[i * 3]     = pt.x * 2;
                targets[i * 3 + 1] = pt.y * 2;
                targets[i * 3 + 2] = 0;  // flat text
            }

        } else {

            info.innerText = "SHOW V-SIGN ✌";
            resetToCloud();
        }

    } else {

        info.innerText = "SEARCHING FOR HAND...";
        resetToCloud();
    }
});


// ============================
// 6️⃣ ANIMATION LOOP
// ============================

function animate() {

    requestAnimationFrame(animate);

    const pos = geometry.attributes.position.array;

    for (let i = 0; i < starCount * 3; i++) {
        pos[i] += (targets[i] - pos[i]) * 0.08;
    }

    geometry.attributes.position.needsUpdate = true;

    stars.rotation.y += 0.001;

    renderer.render(scene, camera);
}


// ============================
// 7️⃣ START BUTTON
// ============================

document.getElementById('start-btn')
.addEventListener('click', async () => {

    document.getElementById('start-btn').style.display = 'none';

    const stream =
        await navigator.mediaDevices.getUserMedia({ video: true });

    video.srcObject = stream;

    animate();

    async function detectionLoop() {
        await hands.send({ image: video });
        requestAnimationFrame(detectionLoop);
    }

    detectionLoop();
});


// ============================
// 8️⃣ RESPONSIVE
// ============================

window.addEventListener('resize', () => {

    camera.aspect =
        window.innerWidth / window.innerHeight;

    camera.updateProjectionMatrix();

    renderer.setSize(
        window.innerWidth,
        window.innerHeight
    );
});
</script>

</body>
</html>